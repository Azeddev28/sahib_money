<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="/static/assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="/static/assets/img/favicon.png">
  <link rel="canonical" href="https://appseed.us/admin-dashboards/django-dashboard-black">

  <title>
    Sahib Money
  </title>

  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,600,700,800" rel="stylesheet" />
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <!-- Nucleo Icons -->
  <link href="/static/assets/css/nucleo-icons.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="/static/assets/css/black-dashboard.css?v=1.0.0" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="/static/assets/demo/demo.css" rel="stylesheet" />

  <!-- Specific Page CSS goes HERE  -->
  {% block stylesheets %}{% endblock stylesheets %}
  <style>
     .otp-field {
        display: flex; 
        align-items: center;
        width: 100%
     }
     form#otp-form {
      padding-left: 20%;
    }
  </style>
</head>

<body class="">
  
  <div class="wrapper">

    <div class="main-panel">


      <div class="content">
        <div class="col-md-8">
          <div class="card">
            <div class="card-header">
              <h4>
                Verify Transaction
              </h4>
            </div>
            <div class="card-body">
              <form id="otp-form" class="form-contact" method="post" data-uuid="{{uuid}}">
                {% csrf_token %}
                    <div class='otp-field'>
                      <label style="color: #fff" class="control-label" for="id_amount">Requested From:</label>
                      <div style="justify-content: center; width: 50%; margin: 15px">
                        <span style="border: 1px solid #fff"class="form-control">{{requested_form}}</span>
                      </div>
                    </div>
                    <div class='otp-field'>
                      <label style="color: #fff" class="control-label" for="id_amount">Amount:</label>
                      <div style="justify-content: center; width: 50%; margin-left: 67px">
                        <span style="border: 1px solid #fff " class="form-control">{{amount}}</span>
                      </div>
                    </div>
                    <div class='otp-field'>
                      <label style="color: #fff; margin-top:19px" class="control-label" for="id_amount">OTP:</label>
                      <div style="justify-content: center; width: 50%; margin-top: 15px; margin-left: 92px">
                        <input style="border: 1px solid #fff" type="text" type="text" class="form-control" name="otp" required="" id="id_otp">
                      </div>
                    </div>
                <input type="button" onclick="submit_transaction('{{ uuid }}')" style='margin-top:5%' class='btn btn-success btn-xs float-right' value="Submit">
                
              </form>
            </div>
          </div>
          <div class='row float-right' style='margin-top: -12px'> 
            <button class="btn btn-info btn-xs" style='margin-right:10px' onclick="resend_otp('{{ uuid }}')">Resend</button>
            <button type="button" class='btn btn-danger btn-xs'
                  onclick="confirmDialog('{{ uuid }}', 'Cancel Transaction', 'Do you want to cancel this transaction?')">Cancel</button>
          </div>
        </div>
      </div>

      {% include 'includes/footer.html' %}

    </div>

  </div>

  <!-- Specific Page JS goes HERE  -->
  {% block javascripts %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script type="text/javascript">
    function submit_transaction(uuid) {
      $.ajax({
        type: "POST",
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
        url: "{% url 'otp_view' uuid %}",
        data: { otp: $("#id_otp").val() },
        success: function (data) {
          window.location.href = data.success_url
        },
        error: function (data) {
          console.log(data)
        }
      });
    }

    function resend_otp(uuid) {
      $.ajax({
        type: "GET",
        url: "{% url 'regenerate_otp' %}",
        data: { "uuid": uuid },
        success: function (data) {
          console.log(data);
        }
      });
    }

    function cancel_transaction(uuid) {
      $.ajax({
        type: "GET",
        url: "{% url 'cancel_withdrawal_transaction' %}",
        data: { "uuid": uuid },
        success: function (data) {
          console.log(data);
        }
      });
    }
    function confirmDialog(uuid, title, message, stay_on_page) {
      $('<div></div>').appendTo('body')
        .html('<div><p style="color: black;">' + message + '</p></div>')
        .dialog({
          modal: true,
          title: title,
          zIndex: 10000,
          autoOpen: true,
          width: 'auto',
          resizable: false,
          buttons: {
            Yes: function () {
              cancel_transaction(uuid)
              window.location.href = "{{company_website}}"
            },
            No: function () {
              $(this).dialog("close");
            }
          },
          close: function (event, ui) {
            $(this).remove();
          }
        });
    };
  </script>
  {% endblock javascripts %}

</body>

</html>